CREATE TABLE IF NOT EXISTS tree (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    parentId INTEGER,
    label_en TEXT,
    label_ja TEXT,
    color TEXT,
    query TEXT,
    sort_order INTEGER
);

CREATE TABLE IF NOT EXISTS media (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    type TEXT NOT NULL,
    treeId INTEGER NOT NULL,
    identifier TEXT,
    label_en TEXT,
    label_ja TEXT,
    streamable BOOLEAN NOT NULL DEFAULT 1,
    tags TEXT DEFAULT "",
    sort_order INTEGER,
    path TEXT UNIQUE NOT NULL,
    checksum TEXT,

    spoken_langs TEXT,
    subtitle_langs TEXT,
    immersible BOOLEAN,
    durationSeconds INTEGER
);

CREATE TABLE IF NOT EXISTS viewing (
    mediaId INTEGER,
    startTime INTEGER NOT NULL,
    endTime INTEGER NOT NULL,
    elapsedSeconds INTEGER,
    location TEXT,
    who TEXT
);

CREATE INDEX media_treeId ON media(treeId);
CREATE INDEX viewing_mediaId_endTime_elapsedSeconds ON viewing(mediaId, endTime, elapsedSeconds);

INSERT INTO tree (label_en, label_ja) VALUES
    ("Movies", "映画"),
    ("TV", "テレビ"),
    ("Shorts", "短編映画"),
    ("LP", "実況プレイ"),
    ("Commercials", "広告"),
    ("Talk", "トーク"),
    ("Video Games", "テレビゲーム"),
    ("Books", "本");
